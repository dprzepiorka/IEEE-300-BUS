 %% PowerWorld Script using SimAuto
clear all;
clc;
tic
global VSN LD PV MG Uwym o M wez Badanie WynikiPocz S Nap MAG Zakresy fcel Nastawy;                         % Nastawy
global Wyniki max_shoots max_iter Xstart;                                           % Wyniki
global SumLoad WezlyPV IloscPV PV_Power;
tic
tStart = tic; 
Badanie.NR = 1;
o=1;
w=1;
Uwym=1.05;      % napięcie wymagane
wez = 117;       % liczba wezłów
i=1;
M=1;

%T={'Nr.'    'Gen.1' 'Gen.10' 'Gen.10029' 'Gen.108' 'Gen.11' 'Gen.119' 'Gen.124' 'Gen.125' 'Gen.126' 'Gen.130' 'Gen.138' 'Gen.139' 'Gen.141' 'Gen.143' 'Gen.146' 'Gen.147' 'Gen.149' 'Gen.152' 'Gen.153' 'Gen.156' 'Gen.166' 'Gen.17' 'Gen.170' 'Gen.171' 'Gen.175' 'Gen.177' 'Gen.186' 'Gen.187' 'Gen.191' 'Gen.198' 'Gen.2' 'Gen.20' 'Gen.214' 'Gen.220' 'Gen.221' 'Gen.222' 'Gen.227' 'Gen.23' 'Gen.230' 'Gen.236' 'Gen.238' 'Gen.239' 'Gen.24' 'Gen.241' 'Gen.242' 'Gen.243' 'Gen.3' 'Gen.372' 'Gen.44' 'Gen.45' 'Gen.49' 'Gen.55' 'Gen.57' 'Gen.61' 'Gen.62' 'Gen.63' 'Gen.7039' 'Gen.71' 'Gen.76' 'Gen.772' 'Gen.8' 'Gen.84' 'Gen.9001' 'Gen.91' 'Gen.92' 'ES.11' 'ES.23' 'ES.7' 'ES.74' 'ES.77' 'LD112' 'LD15' 'LD20' 'LD2' 'LD26' 'LD44' 'Line5.73' 'Line8.14' 'Line79.73' 'Line35.77' 'Line6.2' 'Line73.71' 'Line71.72' };
%T={'Nr.'    'Gen.1' 	'Gen.10' 	'Gen.108' 	'Gen.11' 	'Gen.17' 	'Gen.2' 	'Gen.20' 	'Gen.23' 	'Gen.24' 	'Gen.3' 	'Gen.372' 	'Gen.44' 	'Gen.45' 	'Gen.49' 	'Gen.55' 	'Gen.57' 	'Gen.61' 	'Gen.62' 	'Gen.63' 	'Gen.7039' 	'Gen.71' 	'Gen.76' 	'Gen.772' 	'Gen.8' 	'Gen.84' 	'Gen.9001' 	'Gen.91' 	'Gen.92'  'ES.11' 'ES.23' 'ES.7' 'ES.74' 'ES.77' 'LD112' 'LD15' 'LD20' 'LD2' 'LD26' 'LD44' 'Line5.73' 'Line8.14' 'Line79.73' 'Line35.77' 'Line6.2' 'Line73.71' 'Line71.72' };
T={'Nr.'    'Gen.1' 	'Gen.10' 	'Gen.108' 	'Gen.11' 	'Gen.17' 	'Gen.2' 	'Gen.20' 	'Gen.23' 	'Gen.24' 	'Gen.3' 	'Gen.372' 	'Gen.44' 	'Gen.45' 	'Gen.49' 	'Gen.55' 	'Gen.57' 	'Gen.61' 	'Gen.62' 	'Gen.63' 	'Gen.7039' 	'Gen.71' 	'Gen.76' 	'Gen.772' 	'Gen.8' 	'Gen.84' 	'Gen.9001' 	'Gen.91' 	'Gen.92'  'ES.11' 'ES.23' 'ES.7' 'ES.74' 'ES.77' 'Ld.1'	'Ld.10'	'Ld.100'	'Ld.102'	'Ld.103'	'Ld.104'	'Ld.105'	'Ld.107'	'Ld.108'	'Ld.109'	'Ld.11'	'Ld.110'	'Ld.112'	'Ld.113'	'Ld.114'	'Ld.118'	'Ld.119'	'Ld.120'	'Ld.121'	'Ld.123'	'Ld.124'	'Ld.126'	'Ld.127'	'Ld.13'	'Ld.135'	'Ld.136'	'Ld.137'	'Ld.138'	'Ld.139'	'Ld.14'	'Ld.140'	'Ld.141'	'Ld.142'	'Ld.143'	'Ld.144'	'Ld.145'	'Ld.148'	'Ld.15'	'Ld.152'	'Ld.154'	'Ld.155'	'Ld.156'	'Ld.157'	'Ld.159'	'Ld.16'	'Ld.161'	'Ld.163'	'Ld.167'	'Ld.17'	'Ld.171'	'Ld.173'	'Ld.175'	'Ld.176'	'Ld.177'	'Ld.178'	'Ld.179'	'Ld.18'	'Ld.180'	'Ld.181'	'Ld.182'	'Ld.183'	'Ld.184'	'Ld.186'	'Ld.187'	'Ld.188'	'Ld.19'	'Ld.191'	'Ld.192'	'Ld.196'	'Ld.197'	'Ld.198'	'Ld.199'	'Ld.2'	'Ld.20'	'Ld.200'	'Ld.201'	'Ld.202'	'Ld.203'	'Ld.204'	'Ld.205'	'Ld.206'	'Ld.207'	'Ld.208'	'Ld.209'	'Ld.21'	'Ld.211'	'Ld.214'	'Ld.215'	'Ld.216'	'Ld.217'	'Ld.218'	'Ld.22'	'Ld.220'	'Ld.221'	'Ld.222'	'Ld.223'	'Ld.224'	'Ld.225'	'Ld.227'	'Ld.228'	'Ld.229'	'Ld.23'	'Ld.231'	'Ld.232'	'Ld.234'	'Ld.235'	'Ld.238'	'Ld.24'	'Ld.243'	'Ld.245'	'Ld.246'	'Ld.247'	'Ld.248'	'Ld.25'	'Ld.26'	'Ld.27'	'Ld.281'	'Ld.3'	'Ld.319'	'Ld.320'	'Ld.323'	'Ld.33'	'Ld.34'	'Ld.35'	'Ld.36'	'Ld.37'	'Ld.371'	'Ld.372'	'Ld.38'	'Ld.39'	'Ld.4'	'Ld.40'	'Ld.41'	'Ld.42'	'Ld.43'	'Ld.44'	'Ld.45'	'Ld.46'	'Ld.47'	'Ld.48'	'Ld.49'	'Ld.5'	'Ld.51'	'Ld.52'	'Ld.526'	'Ld.528'	'Ld.53'	'Ld.531'	'Ld.54'	'Ld.55'	'Ld.552'	'Ld.57'	'Ld.58'	'Ld.59'	'Ld.6'	'Ld.60'	'Ld.609'	'Ld.61'	'Ld.62'	'Ld.63'	'Ld.69'	'Ld.7'	'Ld.70'	'Ld.7039'	'Ld.71'	'Ld.72'	'Ld.73'	'Ld.74'	'Ld.76'	'Ld.77'	'Ld.771'	'Ld.772'	'Ld.78'	'Ld.789'	'Ld.79'	'Ld.8'	'Ld.80'	'Ld.81'	'Ld.84'	'Ld.86'	'Ld.87'	'Ld.88'	'Ld.89'	'Ld.9'	'Ld.90'	'Ld.9001'	'Ld.91'	'Ld.92'	'Ld.94'	'Ld.97'	'Ld.98'	'Ld.99'  'Line5.73' 'Line8.14' 'Line73.71' 'Line175.173' 'Line173.172' 'Line35.77' 'Line5.9' 'SumPrze'};

T=cell2table(T);    W=73;
Range="A1:iq1";
writetable(T,'Wyniki1.xlsx','WriteVariableNames',false,'Sheet',1,'Range',Range);


%% Odbiory
LD.P(1,1:192)=[6.7	7.5	12.4	6.3	4.8	8.3	4.2	11.6	8.2	10	8.3	6	4	6.4	4.5	5	10.2	90	26.2	32	8	113	7.5	9.7	14	88.2	225	26.5	33	51.6	38.7	22	28.5	9.8	10.4	27.8	5.2	13.3	38.7	11	29.2	10.5	11.8	5	13.3	118.5	34.5	42.5	12.7	5.8	14.2	24.2	26.5	21	19	7	8.1	12	8.8	19.7	48	22.5	84	7.2	17.5	8.8	5.8	13.2	12.6	6.5	9.4	9.8	7.2	6.2	7.7	5.6	7.8	5.7	12.1	8.1	5.1	6.7	19.4	65.5	5.2	45	5.3	7.1	9.7	25.3	49	19.6	39.2	15.2	15.7	25.3	19.7	6.2	13.1	17.4	7.9	37.6	6.3	10.8	7	5.3	7.6	6.6	5	7.7	9.8	5.4	71	4.2	4	5.2	5.3	4.3	9.4	7.8	5.2	4.1	4.7	9	10.8	20	4.3	7.2	8.9	5.6	7.1	4.7	5	6.8	4.4	16.2	4.3	27.8	70	5.3	9.5	4.5	4.3	8.6	11.3	14.1	23.5	4.8	5.6	4	6.6	8.8	7.4	13.8	9.2	5.9	6.2	5.4	8.4	8.2	4.8	6.1	13.3	13.6	6.4	4.7	1	4.4	16.3	6.1	5.5	9.7	5.8	9	6.1	5	4.8	6.8	48.4	4.7	9	4.1	51.4	10	26.5	8.3	12.9	87.4	45.6	8.2	33.8	30.9];
LD.Q(1,1:192)=[1.1	1.7	0.9	0.4	0.1	0.6	0.1	1.6	0.4	1	0.7	0.2	0.3	0.2	0.2	0.2	0.3	6.3	0.9	3.2	0.7	4.5	0.7	2	0.6	3.2	9.7	7	1.9	4.5	1.7	0.7	1	0.3	0.7	1.5	0.2	0.8	2.3	0.9	1.4	0.4	0.4	0	3.5	6.6	8.9	1.9	2.1	0.1	0.3	5	0.9	0.8	0.9	2.8	0.5	1.6	0.7	0.7	2.1	5.7	9.4	0.1	0.5	0.7	0.4	0.7	7	0.3	0.5	0.4	0.5	0.8	0	0.1	0.2	0.1	0.4	0.9	1.1	0.3	0.5	2.1	1.2	1.5	0.9	3.3	2	3.8	5	2	4.8	6.3	2.6	1.1	0.2	1.9	5.7	6.7	3.1	3	0.1	0.7	0.9	0.7	0.7	0.5	0.3	0.8	0.4	0.2	1.4	0	0.2	0.6	1	1.8	0.5	1	0.5	2.3	0.7	0.5	1.1	4.1	0.1	0.7	1.7	0.3	0.8	0.2	0.1	0.3	0.1	1.1	0.2	2.6	1.4	0.3	2.7	0.8	0.7	1.4	0.7	2.6	2.4	0.9	0.2	0.3	0.3	0.4	0.5	1.1	0.8	0.8	0.2	0.2	0.5	0.8	1	1.1	1.7	0.9	0.4	0.1	0.6	0.3	0.1	1.6	0.4	1	0.7	0.2	0.3	0.2	0.2	0.2	0.3	6.3	0.9	3.2	0.7	4.5	0.7	2	0.6	3.2	9.7	7	1.9	4.5];
LD.W(1,1:192)={'Ld.1'	'Ld.10'	'Ld.100'	'Ld.102'	'Ld.103'	'Ld.104'	'Ld.105'	'Ld.107'	'Ld.108'	'Ld.109'	'Ld.11'	'Ld.110'	'Ld.112'	'Ld.113'	'Ld.114'	'Ld.118'	'Ld.119'	'Ld.120'	'Ld.121'	'Ld.123'	'Ld.124'	'Ld.126'	'Ld.127'	'Ld.13'	'Ld.135'	'Ld.136'	'Ld.137'	'Ld.138'	'Ld.139'	'Ld.14'	'Ld.140'	'Ld.141'	'Ld.142'	'Ld.143'	'Ld.144'	'Ld.145'	'Ld.148'	'Ld.15'	'Ld.152'	'Ld.154'	'Ld.155'	'Ld.156'	'Ld.157'	'Ld.159'	'Ld.16'	'Ld.161'	'Ld.163'	'Ld.167'	'Ld.17'	'Ld.171'	'Ld.173'	'Ld.175'	'Ld.176'	'Ld.177'	'Ld.178'	'Ld.179'	'Ld.18'	'Ld.180'	'Ld.181'	'Ld.182'	'Ld.183'	'Ld.184'	'Ld.186'	'Ld.187'	'Ld.188'	'Ld.19'	'Ld.191'	'Ld.192'	'Ld.196'	'Ld.197'	'Ld.198'	'Ld.199'	'Ld.2'	'Ld.20'	'Ld.200'	'Ld.201'	'Ld.202'	'Ld.203'	'Ld.204'	'Ld.205'	'Ld.206'	'Ld.207'	'Ld.208'	'Ld.209'	'Ld.21'	'Ld.211'	'Ld.214'	'Ld.215'	'Ld.216'	'Ld.217'	'Ld.218'	'Ld.22'	'Ld.220'	'Ld.221'	'Ld.222'	'Ld.223'	'Ld.224'	'Ld.225'	'Ld.227'	'Ld.228'	'Ld.229'	'Ld.23'	'Ld.231'	'Ld.232'	'Ld.234'	'Ld.235'	'Ld.238'	'Ld.24'	'Ld.243'	'Ld.245'	'Ld.246'	'Ld.247'	'Ld.248'	'Ld.25'	'Ld.26'	'Ld.27'	'Ld.281'	'Ld.3'	'Ld.319'	'Ld.320'	'Ld.323'	'Ld.33'	'Ld.34'	'Ld.35'	'Ld.36'	'Ld.37'	'Ld.371'	'Ld.372'	'Ld.38'	'Ld.39'	'Ld.4'	'Ld.40'	'Ld.41'	'Ld.42'	'Ld.43'	'Ld.44'	'Ld.45'	'Ld.46'	'Ld.47'	'Ld.48'	'Ld.49'	'Ld.5'	'Ld.51'	'Ld.52'	'Ld.526'	'Ld.528'	'Ld.53'	'Ld.531'	'Ld.54'	'Ld.55'	'Ld.552'	'Ld.57'	'Ld.58'	'Ld.59'	'Ld.6'	'Ld.60'	'Ld.609'	'Ld.61'	'Ld.62'	'Ld.63'	'Ld.69'	'Ld.7'	'Ld.70'	'Ld.7039'	'Ld.71'	'Ld.72'	'Ld.73'	'Ld.74'	'Ld.76'	'Ld.77'	'Ld.771'	'Ld.772'	'Ld.78'	'Ld.789'	'Ld.79'	'Ld.8'	'Ld.80'	'Ld.81'	'Ld.84'	'Ld.86'	'Ld.87'	'Ld.88'	'Ld.89'	'Ld.9'	'Ld.90'	'Ld.9001'	'Ld.91'	'Ld.92'	'Ld.94'	'Ld.97'	'Ld.98'	'Ld.99'};
LD.W(2,1:192)=num2cell(LD.P(1,1:192));
LD.W(3,1:192)=num2cell(LD.Q(1,1:192));
LD.WyjP=LD.P;



%% Źródła
GEN.P(1,1:65)=[40.2	28.6	61.5	33.4	14.7	106.9	29.5	84.7	49.5	29.5	3.1	197.7	240	51.5	54.1	14	30.1	18.7	46.1	36.8	56.8	19.9	44.1	103.6	49.5	30.7	26.1	38.8	27.4	3.3	30.2	25.5	13.4	46.1	6.7	14.7	65.5	7.7	11.6	145.7	46.8	37.4	69	10.6	38.1	149.7	93.4	9.3	22.8	36.8	52.3	41.7	15	4.4	208.5	41.3	37.9	22.8	51.6	28.3	38.3	64.5	81	27.8	0.6];
GEN.Q(1,1:65)=[177.1	2.3	-105.7	13	28.8	72.7	116.2	269.5	-129.9	-220.3	-5.4	121.4	-24.6	-145.9	-30.2	-13.5	-13.2	-8.9	-11	159.1	-16	-10.9	211.5	-10.6	224.7	112.7	-0.2	-13.1	-44.1	-244	193.4	117.5	-22.4	40.3	76.4	-104.8	-117.3	119.5	-92.4	168.3	-48.9	109.6	-96.6	-107.5	1.1	11.7	-38.7	-58.3	125.1	-84.7	-11.1	-3.9	-2.4	170.7	49.2	-3.3	10.7	48.8	64.1	-51.9	-5.1	1.8	-7.8	-25.2	3.6];
GEN.W(1,1:65)={'Gen.1'	'Gen.10'	'Gen.10029'	'Gen.108'	'Gen.11'	'Gen.119'	'Gen.124'	'Gen.125'	'Gen.126'	'Gen.130'	'Gen.138'	'Gen.139'	'Gen.141'	'Gen.143'	'Gen.146'	'Gen.147'	'Gen.149'	'Gen.152'	'Gen.153'	'Gen.156'	'Gen.166'	'Gen.17'	'Gen.170'	'Gen.171'	'Gen.175'	'Gen.177'	'Gen.186'	'Gen.187'	'Gen.191'	'Gen.198'	'Gen.2'	'Gen.20'	'Gen.214'	'Gen.220'	'Gen.221'	'Gen.222'	'Gen.227'	'Gen.23'	'Gen.230'	'Gen.236'	'Gen.238'	'Gen.239'	'Gen.24'	'Gen.241'	'Gen.242'	'Gen.243'	'Gen.3'	'Gen.372'	'Gen.44'	'Gen.45'	'Gen.49'	'Gen.55'	'Gen.57'	'Gen.61'	'Gen.62'	'Gen.63'	'Gen.7039'	'Gen.71'	'Gen.76'	'Gen.772'	'Gen.8'	'Gen.84'	'Gen.9001'	'Gen.91'	'Gen.92'};
GEN.W(2,1:65)=num2cell(GEN.P(1,1:65));
GEN.W(3,1:65)=num2cell(GEN.Q(1,1:65));

GEN.Wyj=GEN.P;

%% Źródła
ES.Wyj(1,1:5)=[-50 -50 -50 -50 -50];
ES.Q(1,1:5)=[0 0 0 0 0];


ES.P=[-1.5	31.6	49.7	61.2	66.7];






while Badanie.NR<=2000
if Badanie.NR>1
LosNast();
end
Write();

% Waiting for DIgSILENT to Complete the PowerFlow Process %
dlg = 0;
while dlg == 0
      pause(0.02);
      try
      dlg = load('Couple.txt');
      catch
        pause(0.02);
      end    
end

Rozp = load('RozpData.txt');

if Rozp==1
Read();
if Wyniki.SumGenP >1750 || Wyniki.SumGenP <5250
Export();
Badanie.NR=Badanie.NR+1;
end
end
end


End();

s = seconds(toc);  
s.Format = 'hh:mm:ss';
disp('Ukończone w ');
disp(s)